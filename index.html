<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>Speicher-Test</title>

<style>
body {background:#000;color:#fff;font-family:sans-serif;}
.popup-bg {
  position:fixed;inset:0;background:rgba(0,0,0,0.7);
  display:flex;justify-content:center;align-items:center;
}
.popup {
  background:#111;border:2px solid #3aa9ff;border-radius:10px;
  width:90%;max-width:360px;padding:20px;
}
input {width:100%;margin:8px 0;padding:8px;}
button {
  background:#222;color:white;padding:10px;border:1px solid #333;
  width:48%;border-radius:8px;
}
</style>
</head>

<body>

<h2>TEST – Funktioniert Speichern?</h2>
<button id="open">Artikel anlegen</button>

<div class="popup-bg" id="bg" style="display:none;">
  <div class="popup">
    <h3>Artikel anlegen</h3>
    <input id="name" placeholder="Name">
    <input id="qty" type="number" placeholder="Menge">
    <div style="display:flex;justify-content:space-between;">
      <button id="saveBtn">Speichern</button>
      <button onclick="document.getElementById('bg').style.display='none';">Abbruch</button>
    </div>
  </div>
</div>

<script>
// -------------------------
// DATABASE INITIALISIEREN
// -------------------------
let db;
let req = indexedDB.open("TESTDB", 1);

req.onupgradeneeded = e => {
  db = e.target.result;
  if (!db.objectStoreNames.contains("artikel"))
    db.createObjectStore("artikel", { keyPath: "id", autoIncrement: true });
};

req.onsuccess = e => {
  db = e.target.result;
  console.log("DB fertig");
};

req.onerror = e => alert("DB Fehler: " + e.target.error);


// -------------------------
// POPUP öffnen
// -------------------------
document.getElementById("open").addEventListener("click", () => {
  document.getElementById("bg").style.display = "flex";
});


// -------------------------
// SAFARI-SICHERES SPEICHERN
// -------------------------
document.getElementById("saveBtn").addEventListener("click", async () => {
  if (!db) {
    alert("DB nicht bereit");
    return;
  }

  let name = document.getElementById("name").value.trim();
  let qty = parseInt(document.getElementById("qty").value) || 0;

  let tx = db.transaction("artikel", "readwrite");
  let store = tx.objectStore("artikel");

  store.add({ name, qty });

  tx.oncomplete = () => {
    alert("Artikel gespeichert!");
    document.getElementById("bg").style.display = "none";
  };

  tx.onerror = e => alert("Speicherfehler: " + e.target.error);
});
</script>

</body>
</html>
