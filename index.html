<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Lager App</title>
<style>
body {
    margin: 0;
    background: #000;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
}
#topbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 15px;
    background: #000;
    z-index: 9999; 
    border-bottom: 2px solid #333;
}
#counterWrapper {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}
.counter-box {
    padding: 10px;
    border: 1px solid #444;
    border-radius: 10px;
    background: #000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.45);
}
.counter-title { font-size: 11px; color: #bbb; }
.counter-value { font-size: 18px; font-weight: bold; }
#searchRow {margin-top: 10px;}
#search {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    background: #111;
    border: 1px solid #444;
    color: white;
    box-sizing: border-box;
}
#buttonRow { margin-top: 10px; display: flex; gap: 8px; touch-action: manipulation; }
#buttonRow button {
    flex: 1;
    padding: 10px;
    font-size: 11px;       
    color: #bbb;           
    border-radius: 10px;
    background: #000;
    border: 1px solid #444;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.45);
    pointer-events: auto;  
}
#buttonRow button:active {background: #111;}
#tableContainer {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    overflow-x: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    table-layout: auto; 
}
th {
    background: #111;
    position: sticky;
    top: 0;
    z-index: 5;
    padding: 5px;
    color: #bbb;          
    font-weight: bold;
}
td {
    padding: 5px;
    border-bottom: 1px solid #222;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
}
#popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #111;
    padding: 10px;
    border: 2px solid #444;
    border-radius: 12px;
    width: 80%;
    max-width: 320px;
    display: none;
    z-index: 10000;
}
.popup-row {
    margin-bottom: 6px;
    display: flex;
    flex-direction: column;
}
.popup-row label { font-size: 13px; margin-bottom: 2px; }
.popup-row input, .popup-row textarea {
    width: 100%;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #444;
    background: #1a1a1a;
    color: white;
    font-size: 13px;
    box-sizing: border-box;
}
#popup button {
    padding: 8px;
    border-radius: 8px;
    background: #000;
    border: 1px solid #444;
    color: white;
    font-weight: bold;
    font-size: 13px;
}
.icon-btn {
    cursor: pointer;
    margin-left: 4px;
    font-size: 14px;
}
input.table-input {
    width: 50px;
    background: #111;
    color: white;
    border: 1px solid #444;
    border-radius: 4px;
    text-align: center;
}
</style>
</head>
<body>
<div id="topbar">
    <div id="counterWrapper">
        <div class="counter-box"><div class="counter-title">Artikel im Bestand</div><div class="counter-value" id="countArtikel">0</div></div>
        <div class="counter-box"><div class="counter-title">Gegenst√§nde insgesamt</div><div class="counter-value" id="countMenge">0</div></div>
        <div class="counter-box"><div class="counter-title">Warenwert aktuell (‚Ç¨)</div><div class="counter-value" id="countWert">0</div></div>
        <div class="counter-box"><div class="counter-title">Warenwert gesamt (‚Ç¨)</div><div class="counter-value" id="countWertTotal">0</div></div>
    </div>
    <div id="searchRow">
        <input type="text" id="search" placeholder="Suchen ‚Ä¶" oninput="searchTable()">
    </div>
    <div id="buttonRow">
        <button onclick="openPopup()">Artikel anlegen</button>
        <button onclick="exportData()">Sicherung speichern</button>
        <button onclick="importData()">Sicherung laden</button>
        <button onclick="generatePDF()">Inventur PDF</button>
    </div>
</div>
<div id="tableContainer">
<table id="artikelTable">
<thead>
<tr>
<th>ArtNr</th><th>Name</th><th>Menge</th><th>Gr√∂√üe</th><th>Preis</th><th>Ort</th><th>Gekauft</th><th>Aktionen</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<div id="popup">
<div class="popup-row"><label>Artikelnummer</label><input id="p_artnr"></div>
<div class="popup-row"><label>Name</label><input id="p_name"></div>
<div class="popup-row"><label>Menge</label><input type="number" id="p_menge" min="1" value="1"></div>
<div class="popup-row"><label>Gr√∂√üe</label><input id="p_groesse" placeholder="z. B. M, L, XL"></div>
<div class="popup-row"><label>Preis</label><input type="number" id="p_preis" step="0.01"></div>
<div class="popup-row"><label>Wo gekauft</label><input id="p_ort"></div>
<div class="popup-row"><label>Wann gekauft</label><input type="date" id="p_datum" style="width:100%; text-align:center;"></div>
<div class="popup-row"><label>Bild / Rechnung</label><input type="file" id="p_bild" accept="image/*"></div>
<div class="popup-row"><label>Notiz</label><textarea id="p_notiz" rows="2"></textarea></div>
<div style="display: flex; gap: 10px;">
<button onclick="saveArtikel()" style="flex:1;">Speichern</button>
<button onclick="document.getElementById('popup').style.display='none'" style="flex:1;">Abbrechen</button>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let artikel = JSON.parse(localStorage.getItem("lagerData") || "[]");
let editIndex = null;
updateCounters(); renderTable();

function openPopup() { document.getElementById("popup").style.display = "block"; }
function formatDatum(d){ if(!d) return ""; const dt=new Date(d); const tag=("0"+dt.getDate()).slice(-2); const monat=("0"+(dt.getMonth()+1)).slice(-2); const jahr=dt.getFullYear(); return `${tag}-${monat}-${jahr}`; }

function saveArtikel(){
    const n = document.getElementById("p_artnr").value.trim();
    const name = document.getElementById("p_name").value.trim();
    const menge = Number(document.getElementById("p_menge").value);
    const groesse = document.getElementById("p_groesse").value.trim();
    const preis = Number(document.getElementById("p_preis").value);
    const ort = document.getElementById("p_ort").value.trim();
    const datum = document.getElementById("p_datum").value;
    const bildInput = document.getElementById("p_bild");
    const notiz = document.getElementById("p_notiz").value.trim();
    if(!n || !name) return;

    function pushItem(b64){
        const obj={artnr:n,name,menge,groesse,preis,ort,datum,bild:b64,notiz};
        if(editIndex!==null){ artikel[editIndex]=obj; editIndex=null; }
        else artikel.push(obj);
        localStorage.setItem("lagerData",JSON.stringify(artikel));
        renderTable(); updateCounters();
        document.getElementById("popup").style.display="none";
    }
    if(bildInput.files.length>0){
        const reader=new FileReader();
        reader.onload=function(e){ pushItem(e.target.result); }
        reader.readAsDataURL(bildInput.files[0]);
    } else pushItem("");
}

function renderTable(){
    const tbody=document.getElementById("tableBody"); tbody.innerHTML="";
    artikel.forEach((a,i)=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${a.artnr}</td>
            <td title="${a.name}">${a.name}</td>
            <td><input type="number" class="table-input" value="${a.menge}" onchange="updateMenge(${i},this.value)"></td>
            <td>${a.groesse||'-'}</td>
            <td>${a.preis.toFixed(2)}</td>
            <td title="${a.ort}">${a.ort}</td>
            <td>${formatDatum(a.datum)}</td>
            <td>
                <span class="icon-btn" onclick="openEdit(${i})">‚úèÔ∏è</span>
                <span class="icon-btn" onclick="showImage(${i})">üì∑</span>
                <span class="icon-btn" onclick="toggleMark(${i})">‚òÖ</span>
                <span class="icon-btn" onclick="deleteItem(${i})" style="margin-left:12px;">‚ùå</span>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function updateCounters(){
    document.getElementById("countArtikel").innerText=artikel.length;
    let menge=0,wert=0;
    artikel.forEach(a=>{ menge+=a.menge; wert+=a.menge*a.preis; });
    document.getElementById("countMenge").innerText=menge;
    document.getElementById("countWert").innerText=wert.toFixed(2);
    document.getElementById("countWertTotal").innerText=wert.toFixed(2);
}

function updateMenge(i,v){
    artikel[i].menge=Number(v); localStorage.setItem("lagerData",JSON.stringify(artikel)); updateCounters();
}

function searchTable(){
    const q=document.getElementById("search").value.toLowerCase();
    document.querySelectorAll("#artikelTable tbody tr").forEach(r=>{ r.style.display=r.innerText.toLowerCase().includes(q)?'':''; });
}

function exportData(){
    const blob=new Blob([JSON.stringify(artikel)],{type:"application/json"});
    const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="lager_sicherung.json"; a.click();
}

function importData(){
    const inp=document.createElement("input"); inp.type="file"; inp.accept="application/json";
    inp.onchange=e=>{
        const file=e.target.files[0]; const reader=new FileReader();
        reader.onload=function(){ artikel=JSON.parse(reader.result); localStorage.setItem("lagerData",JSON.stringify(artikel)); renderTable(); updateCounters(); };
        reader.readAsText(file);
    }; inp.click();
}

function generatePDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y=10;
    doc.setFontSize(10);
    doc.text("Inventur",105,10,{align:"center"});
    artikel.forEach((a,i)=>{
        y+=6; if(y>280){ doc.addPage(); y=10; }
        const line=`${i+1}. ${a.artnr} | ${a.name} | Menge: ${a.menge} | Preis: ${a.preis.toFixed(2)}‚Ç¨ | Ort: ${a.ort} | Datum: ${formatDatum(a.datum)} | Gr√∂√üe: ${a.groesse||'-'}`;
        doc.text(line,10,y);
    });
    doc.save("inventur.pdf");
}

function editNote(i){
    const n=prompt("Notiz bearbeiten:",artikel[i].notiz);
    if(n!==null){ artikel[i].notiz=n; localStorage.setItem("lagerData",JSON.stringify(artikel)); }
}

function showImage(i){
    if(artikel[i].bild) window.open(artikel[i].bild);
    else alert("Kein Bild vorhanden");
}

function deleteItem(i){
    if(confirm("Willst du den Artikel wirklich l√∂schen?")){
        artikel.splice(i,1); localStorage.setItem("lagerData",JSON.stringify(artikel)); renderTable(); updateCounters();
    }
}

function toggleMark(i){
    const row=document.querySelectorAll("#tableBody tr")[i];
    row.style.background=row.style.background==''?'#001f44':'';
}

function openEdit(i){
    editIndex=i;
    const a=artikel[i];
    document.getElementById("p_artnr").value=a.artnr;
    document.getElementById("p_name").value=a.name;
    document.getElementById("p_menge").value=a.menge;
    document.getElementById("p_groesse").value=a.groesse;
    document.getElementById("p_preis").value=a.preis;
    document.getElementById("p_ort").value=a.ort;
    document.getElementById("p_datum").value=a.datum;
    document.getElementById("p_notiz").value=a.notiz;
    document.getElementById("popup").style.display="block";
}

function adjustTableTop(){
    const header=document.getElementById("topbar");
    document.getElementById("tableContainer").style.top = header.offsetHeight + "px";
}
window.onload=adjustTableTop;
window.onresize=adjustTableTop;
</script>
</body>
</html>
